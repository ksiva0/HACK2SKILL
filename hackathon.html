<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Handmade Marketplace</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body {font-family:'Roboto',sans-serif;margin:0;background:#f5f5f5;color:#333;}
header {background:#8B4513;color:white;padding:20px;text-align:center;position:sticky;top:0;z-index:100;}
.container {max-width:950px;margin:20px auto;background:white;padding:20px;border-radius:12px;}
h2{text-align:center;color:#8B4513;margin-bottom:15px;}
input, textarea, select, button {width:100%;padding:10px;margin:5px 0;border-radius:6px;border:1px solid #ccc;font-size:1rem;}
button {background:#8B4513;color:white;font-weight:bold;cursor:pointer;transition:0.3s;}
button:hover {background:#A0522D;}
.product-grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px;}
.card {border:1px solid #ddd;padding:10px;border-radius:10px;background:#fffaf0;transition:transform 0.2s;}
.card:hover {transform:scale(1.02);}
.card img {width:100%;height:180px;object-fit:cover;border-radius:8px;margin-bottom:8px;}
.product-actions {display:flex;justify-content:space-between;flex-wrap:wrap;}
nav {display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-bottom:15px;}
#imageOptions {display:none;margin-top:10px;}
</style>
</head>
<body>
<header>
<h1>AI Handmade Marketplace</h1>
<p>Fair Trade • Authentic • Local • AI Powered</p>
</header>
<div class="container" id="app"></div>

<script>
// ===== State =====
let currentUser=null;
if(!localStorage.getItem("products")){
    const starter=[
        {id:1,name:"Handmade Basket",desc:"Eco-friendly bamboo basket.",img:"https://i.ibb.co/Nj6d6c3/basket.jpg",category:"Home Decor",owner:"admin"},
        {id:2,name:"Clay Pot",desc:"Traditional handcrafted clay pot.",img:"https://i.ibb.co/RDkbnT1/clay-pot.jpg",category:"Kitchenware",owner:"admin"}
    ];
    localStorage.setItem("products",JSON.stringify(starter));
}
if(!localStorage.getItem("cart")) localStorage.setItem("cart",JSON.stringify([]));

// ===== SPA Navigation with Browser History =====
function navigateTo(page, push=true){
    if(push) history.pushState({page}, "", "");
    pages[page]();
}
window.onpopstate=function(event){
    if(event.state && event.state.page){ pages[event.state.page](); }
    else loadIntro(false);
};

// ===== Pages Object =====
const pages={};

pages['intro']=function(){
    document.getElementById("app").innerHTML=`
    <h2>Welcome to AI Handmade Marketplace</h2>
    <div style="text-align:center;">
        <button onclick="navigateTo('register')">Register</button>
        <button onclick="navigateTo('login')">Login</button>
    </div>`;
};

pages['register']=function(){
    document.getElementById("app").innerHTML=`
    <h2>Register</h2>
    <input type="text" id="name" placeholder="Your Name">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="register()">Register</button>`;
};

function register(){
    const name=document.getElementById("name").value;
    const email=document.getElementById("email").value;
    const password=document.getElementById("password").value;
    if(!name||!email||!password){alert("Fill all fields"); return;}
    localStorage.setItem("user",JSON.stringify({name,email,password}));
    alert("Registered! Login now."); navigateTo('login');
}

pages['login']=function(){
    document.getElementById("app").innerHTML=`
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="login()">Login</button>`;
};

function login(){
    const user=JSON.parse(localStorage.getItem("user"));
    const email=document.getElementById("loginEmail").value;
    const pass=document.getElementById("loginPassword").value;
    if(user && user.email===email && user.password===pass){ currentUser=user.name; navigateTo('dashboard'); }
    else alert("Invalid credentials!");
}

// ===== Dashboard =====
pages['dashboard']=function(){
    document.getElementById("app").innerHTML=`
    <h2>Dashboard</h2>
    <p>Welcome, <strong>${currentUser}</strong></p>
    <nav>
        <button onclick="navigateTo('explore')">Explore Products</button>
        <button onclick="navigateTo('sell')">Sell Product</button>
        <button onclick="navigateTo('myProducts')">My Products</button>
        <button onclick="navigateTo('cart')">My Cart</button>
        <button onclick="logout()">Logout</button>
    </nav>`;
};

function logout(){ currentUser=null; navigateTo('intro'); }

// ===== Explore Products =====
pages['explore']=function(){
    const products=JSON.parse(localStorage.getItem("products"))||[];
    let html=`<h2>Explore Products</h2>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px;">
        <input type="text" id="searchInput" placeholder="Search..." onkeyup="filterExplore()">
    </div>
    <div id="productList" class="product-grid"></div>`;
    document.getElementById("app").innerHTML=html;
    displayProducts(products);
};

function displayProducts(products){
    const container=document.getElementById("productList");
    if(products.length===0){container.innerHTML="<p>No products found.</p>"; return;}
    container.innerHTML=products.map(p=>`
        <div class="card">
            <img src="${p.img}">
            <h3>${p.name}</h3>
            <p>${p.desc}</p>
            <small>Category: ${p.category}</small>
            <div class="product-actions"><button onclick="addToCart(${p.id})">Add to Cart</button></div>
        </div>`).join('');
}

function filterExplore(){
    const products=JSON.parse(localStorage.getItem("products"))||[];
    const search=document.getElementById("searchInput").value.toLowerCase();
    const filtered=products.filter(p=>p.name.toLowerCase().includes(search));
    displayProducts(filtered);
}

// ===== Cart =====
pages['cart']=function(){
    const cart=JSON.parse(localStorage.getItem("cart"))||[];
    const products=JSON.parse(localStorage.getItem("products"))||[];
    const cartProducts=products.filter(p=>cart.includes(p.id));
    let html=`<h2>My Cart</h2>`;
    if(cartProducts.length===0) html+="<p>Cart empty</p>";
    else html+=cartProducts.map(p=>`<div class="card"><img src="${p.img}"><h3>${p.name}</h3><p>${p.desc}</p></div>`).join('');
    document.getElementById("app").innerHTML=html;
};

function addToCart(id){
    let cart=JSON.parse(localStorage.getItem("cart"))||[];
    if(!cart.includes(id)){cart.push(id); localStorage.setItem("cart",JSON.stringify(cart)); alert("Added to cart");}
    else alert("Already in cart");
}

// ===== Sell Product =====
pages['sell']=function(){
    document.getElementById("app").innerHTML=`
<h2>Sell Your Product</h2>
<input type="text" id="pname" placeholder="Product Name">
<input type="text" id="pcat" placeholder="Category">
<textarea id="pdesc" placeholder="Description"></textarea>
<button onclick="showImageOptions()">Upload/Take Photo</button>
<div id="imageOptions">
<input type="file" id="pfile" accept="image/*">
<input type="file" id="pcapture" accept="image/*" capture="environment">
</div>
<button onclick="addProduct()">Add Product</button>`;
};

function showImageOptions(){ const d=document.getElementById("imageOptions"); d.style.display="block"; }

function addProduct(){
    const name=document.getElementById("pname").value;
    const cat=document.getElementById("pcat").value;
    const desc=document.getElementById("pdesc").value;
    if(!name||!cat||!desc){alert("Fill all fields");return;}
    let file=document.getElementById("pfile").files[0]||document.getElementById("pcapture").files[0];
    if(!file){alert("Upload/capture an image"); return;}
    const reader=new FileReader();
    reader.onload=function(e){
        const img=e.target.result;
        let products=JSON.parse(localStorage.getItem("products"))||[];
        const id=products.length?Math.max(...products.map(p=>p.id))+1:1;
        products.push({id,name,desc,img,category:cat,owner:currentUser});
        localStorage.setItem("products",JSON.stringify(products));
        alert("Product added!"); navigateTo('dashboard');
    };
    reader.readAsDataURL(file);
}

// ===== My Products =====
pages['myProducts']=function(){
    const products=JSON.parse(localStorage.getItem("products"))||[];
    const myProds=products.filter(p=>p.owner===currentUser);
    let html=`<h2>My Products</h2>`;
    if(myProds.length===0) html+="<p>No products</p>";
    else html+=myProds.map(p=>`<div class="card"><img src="${p.img}"><h3>${p.name}</h3><p>${p.desc}</p></div>`).join('');
    document.getElementById("app").innerHTML=html;
};

// ===== Initialize =====
navigateTo('intro', false);
</script>
</body>
</html>
